<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head>	<meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">	<title>Blackjack Software</title>	<link rel="stylesheet" type="text/css" href="etables.css"></head><body><h1>Blackjack Project</h1><img src = "Blackjack.jpg"  height = "200" alt = "" align="right" />
<p>This documentation file describes the public-domain, command-line tool in this project that calculate a variety of blackjack expected values. The documentation sections are:</p>
<div class="contents"><b>Contents</b><ul class="index"><li><a href="#obtain">Compiling the Code</a></li><li><a href="#run">Running the Code</a></li><li><a href="#sample">Sample Calculations</a></li></ul></div><a name="obtain"></a><h1>Compiling the Code</h1>
<p>The command-line tool called <code>Blackjack</code> is written in standard <code>C++</code> code. You can compile it on any system that supports <code>C++</code> code.</p><dl><dt>Compiling in an IDE</dt><dd>This project includes an XCode project (for compiling on a Mac) and a Visual Studio project (for compiling in Windows - coming soon). These projects should build immediately or might need some minor modifications to build settings if you computer differs enough from the one used to create the projects.</dd><dt>Command-Line Compiling the Code</dt><dd>The software can also be compiled in a command-line environment. Navigate to the "build" folder in this project and use the <code>make</code> command:<pre>cd buildmakemake install</pre>The make command will install the <code>Blackjack</code> binary in this project's "calculations" folder. If you prefer, the "<code>make install</code>" command will transfer the executable file to your user "<code>~/bin</code> folder. See <code>ReadMe.txt</code> and the <code>makefile</code> contents for more details and to change options in the compilation process.</dd></dl><a name="run"></a><h1>Running the Code</h1><p>The <code>Blackjack</code> executable runs in a command-line environment. Each run does a selected set of calculations and outputs the results to standard output (which can be diverted to an output file instead). The command-line format is:</p><pre>
Blackjack [calculations] [options]
</pre><p>where <code>[calculations]</code> specify the desired calculations to be run and <code>[options]</code> selects various options for running those calculations. The following sections explain the types of calculations and the option settings:</p><div class="contents"><b>Contents</b><ul class="index"><li><a href="#calcs">Expected Value Calculations</a></li><li><a href="#game">Specific Game Analysis</a></li><li><a href="#counting">Sample Calculations</a></li><li><a href="#options">Options</a></li></ul></div><a name="calcs"></a><h3>Expected Value Calculations</h3><p>These calculations examine each initial two-card player hand, and calculates the expected value of playing by one specific option. For each dealer up card that is analyzed, the output will be a tab-delimited table of results for the possible player hands. Note the most expected values are exact (to six-digit precision) and found by enumerating through all possible hands. Even splitting calculations can be done exactly, but enumeration through all possible combinations of splitting hands can take a long time. An approximate, but accurate, alternative can find splitting expected values much faster.</p><dl><dt>-S</dt><dd>Find exact expected values for standing on all possible two-card initial hands.</dd><dt>-H</dt><dd>Find exact expected values for hitting all possible two-card initial hands and then continuing to play by basic strategy.</dd><dt>-D</dt><dd>Find exact expected values for doubling down on all possible two-card initial hands.</dd><dt>-En</dt>
<dd>Find exact expected values for splitting all possible pairs of cards with resplitting allowed up to total of <code>n</code> hands (where <code>n</code> is the number immediately after the <code>E</code>). This calculation uses the methods developed by the author that make them possible [<a href="#nairn">2</a>], but still require a lengthy calculation. For each pair the table will include three results for doubling down after splitting not allowed, allowed on any two cards, or allowed only on hands of 10 or 11. For interactive splitting calculations, you should use the approximate approach in the <code>-A</code> option. For exact results derived using the <code>-En</code> option you can refer to posted <a href="index.html#tables">tabulated results</a> for a single deck game or the Excel file in this project's calculations folder.</dd><dt>-A</dt>
<dd>Find approximate expected values for splitting all possible pairs of cards. For each pair the table will include results for splitting and resplitting. For each of them, the table will have results for doubling down after splitting not allowed, allowed on any two cards, or allowed only on hands of 10 or 11. Each line will have six results. The calculations when resplitting is not allowed use methods developed by Peter Griffin [<a href="#griffin">1</a>]. The calculations when resplitting is allowed use the new and highly accurate approximate methods developed by the author [<a href="#nairn">2</a>].</dd><dt>-Rn</dt><dd>This option provides an alternate method for exact splitting calculations that enumerates through all possible hands. It is very slow compared to the corresponding <code>-En</code> option and should never be used. The <code>R</code> stands for it being the &quot;Recursive&quot; method described in a paper by the author [<a href="#nairn">2</a>]. It is in this software just for comparison to the <code>-En</code> method.</dd></dl><p>The <a href="#options">game-rule options</a> that affect the expected values are number of decks (<code>-dn</code>) and whether the dealer hits or stands on soft 17 (<code>-s</code>, <code>-h</code>). Note for dealer up cards 7, 8, 9, and 10, the expected values are identical for dealers that hit or stand on soft 17.</p><p>The <a href="#outoptions">output options</a> control output and some calculation methods. Most importantly, the <code>-c</code> option creates a dealer probability cache that significantly speeds up the calculations. See paper by the author for details on that cache [<a href="#nairn">2</a>].</p><a name="game"></a><h3>Specific Game Analysis</h3><p>For a given initial player hand, the optimal strategy is the one that maximizes the player's expected value. The one option in this section outputs tables with optimum strategy for each hand and the resulting expected value when using that strategy. The calculated expected values depend on one specific set rules that should be set first using the <a href="#options">game-rule options</a>.</p><dl><dt>-C</dt><dd>This option considers each player hand against the current dealer up card, finds expected values for standing, hitting, doubling down, and splitting (when allowed) and outputs which option was the optimum choice (<i>i.e.</i>, <code>S</code>, <code>H</code>, <code>D</code>, or <code>P</code> for stand, hit, double, or split) along with its expected value. The splitting calculations use the approximate methods (see <code>-A</code> option).</dd></dl><p>If the <code>-C</code> option analyzes all dealer up cards (Ace through Ten), those ten tables will be followed by a full gane analysis that gives the expected value for playing a game with <a href="#options">provided rules</a> when using the optimum basic strategy.</p><p>The <a href="#outoptions">output options</a> control output and some calculation methods. Most importantly, the <code>-c</code> option creates a dealer probability cache that significantly speeds up the calculations. See paper by the author for details on that cache [<a href="#nairn">2</a>].</p><a name="counting"></a><h3>Card Counting Analysis</h3><p>The goal of card-counting methods is to use knowledge of which cards have been removed from the current deck to estimate your gain of one strategy decision over another. The game of blackjack has many different strategy decisions. When playing cards for example, is it better to hit a hard 16 hand against a dealer up card 10 or to stand? This decision should be based on whether or not the the current expected value for hitting is higher than for standing. The most important strategy decision is whether to play the next hand. This decision should be based on whether the current deck offers an advantage to the player or to the house.</p><p>Let G be the gain for any blackjack strategy choice (and we make that choice whenever G&gt;0). All card-counting methods are based on estimating G by a linear combination of removed cards. Peter Griffin [<a href="#griffin">1</a>] proved that the best estimate of G (as determined by method of least squares) when k cards have been removed is:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G = &mu; + [(N-1)/(N-k)] &Sigma;<sub>j</sub> E<sub>j</sub></p><p>where &mu; is the gain for that decisions with a full deck of N cards and E<sub>j</sub> is the change in gain for a deck of N-1 cards with card of type j removed. A proof of this equation is given in a <a href="RemovalWeights.pdf">PDF file</a> in this project. Note that the original deck of N cards could be one or more full decks or a deck with one or more cards already removed.</p><p>By the above equation, we see that calculation &mu; and E<sub>j</sub> for all possible dealer up cards and all possible removed cards provide "virtually complete blackjack tables" [<a href="#griffin">1</a>] for developing and evaluating card-counting methods. The commands in this section can calculate those tables. One ambiguity is if the gables should be calculated starting with a full deck (N=52*(number of decks)) or if it should start with a deck that has the dealer up card already removed (52*(number of decks)-1). Griffin's book is ambiguous on these options. Some text uses a deck with removed dealer up card, but the tables in the book match better to full deck analysis. The <code>-G</code> and <code>-g</code> options can try both methods. The <code>-Bn</code> option is for finding the effect of removing cards on the full expected value of blackjack betting.</p><dl><dt>-G</dt><dd>Calculates means and effects of card removal for all blackjack hand-playing decisions:<ul><li>HITTING HARD HANDS - considers whether or not to hit a hard hand with an abstract total of 12 to 17 against dealer up card.</li><li>HITTING SOFT HANDS - considers whether or not to hit a soft hand with various abstract totals.</li><li>HARD DOUBLING DOWN - considers whether or not to double down a hard hand with various abstract totals.</li><li>SOFT DOUBLING DOWN - considers whether or not to double down a soft hand with various abstract totals.</li><li>SPLITTING - considers whether or not to split a matching pair. Unlike other calculations, these calculations remove the two splits cards (otherwise resplitting calculations would not be accurate) and work with a deck of 52*(number of decks)-2 cards. The splitting calculations use the approximate methods (see <code>-A</code> option).</a></ul>For each decision this option calculates the difference between that decision and the opposite decision (<i>e.g.</i>, hitting vs. standing) calling that the &quot;mean&quot; (&mu;). It then repeats that calculation for decks in which a single card of one denomination is removed and finds the <i>change</i> in mean value for each type of removed card calling that the &quot;effect of card removal&quot; (E<sub>j</sub>). For doubling down and splitting, the table will be calculated only for the current <a href="#options">game rules</a>.<br><br>This command calculates the mean value with a full deck (<i>i.e.</i>, the player cards and the dealer up card are not removed from the deck, except for splitting). This approach is identical to the one taken by Griffin [<a href="#griffin">1</a>] and many results are identical. The reasons some results differ is not known. Griffin does not give enough details to evaluate his computer methods. The results calculated here are believed to be accurate. The output table will list means and effects in percents. The table will include only strategy decisions for which the mean value is greater than -25%; those with lower means are unlikely to be relevant in counting calculations.</dd><dt>-g</dt><dd>This command calculates the same Griffin tables as the <code>-G</code> option except that it starts with a deck in which the dealer up card has been removed. The approach was mentioned by Griffin [<a href="#griffin">1</a>] and might provide tables for slightly more accurate counting calculations.
</dd><dt>-Bn</dt><dd>This command repeats the complete <a href#="game">game analysis</a> of the <code>-C</code> command but with card <code>n</code> removed. The <code>-C</code> calculates the mean (&mu;) for decision ot better or not betting on the next hand while a <code>-Bn</code> command calculates the effect on game expected value by removing card <code>n</code> (E<sub>j</sub> for <code>j=n</code>).</dd></dl><h4>Sample Table Calculations</h4><p>To see sample calculations with these tables, consider hitting a hard hand against a dealer 10 in a one deck game. The table row using the <code>-G</code> command is:</p><table align="center"><tr><th>Mean</th><th>A</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr><td>-0.45</td><td>-0.49</td><td>-0.29</td><td>-0.80</td><td>-1.73</td><td>-2.57</td><td>1.64</td><td>-0.71</td><td>-0.06</td><td>0.55</td><td>1.12</td></tr></table><p>Applying this to hitting a specific hand with (10,6), the estimated gain is</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;G = -0.45 + (52/49)*(2*1.12+1.64) = 3.67%</p><p>or remove two 10's and one 6. The exact expected value that is found from tables using the <code>-H</code> and <code>-S</code> commands is 3.62%. Repeating the calculations for hands of (9,7) and (8,8) gives gain of 0.57% and 0.62%, respectively. The exact calculations give gains of 0.60% and 0.65%. In all cases, the approximate calculations are close to exact calculations and all recommend the hands should be hit.</p><p>Repeating this calculation for all three card hands shows that hands (10,3,3), (9,6,1), (8,6,2), (7,6,3), and (6,6,4) should be hit while it is better to stand on hands (10,5,1), (10,4,2), (9,5,2), (9,4,3), (8,7,1), (8,5,3), (8,4,4), (7,7,2), (7,4,4), and (6,5,5). The hands that should stand have two or more cards with negative E<sub>j</sub>. In brief most three-card 16's (and likely all four-card 16's) should stand against a dealer 10.</p><a name="options"></a><h3>Options</h3><p>These options control rules of the game being analyzed:</p><dl><dt>-d2</dt><dd>Set the number of decks. The number must follow the <code>d</code> without a space and must be in the range 1 to 8. The default is 1 deck.</dd><dt>-s or -h</dt><dd>Set the dealer play. The <code>-s</code> options sets the dealer to stand on soft 17; the <code>-h</code> option sets the dealer to hit soft 17. The default is dealer stand on soft 17.</dd><dt>-l or -r</dt><dd>Set the doubling down rules. This rule is only needed <a href="#game">specific game</a> (option <code>-C</code>) or <a href="#counting">card counting</a> (options <code>-G</code> and <code>-g</code>) analysis tables. The settings are <code>-l</code> for doubling down on any two cards (Las Vegas rules) or <code>-r</code> for doubling down on 10 &amp; 11 only (Reno rules). The default is <code>-l</code>.</dd><dt>-n</dt><dd>Set the doubling down after splitting rule. This rule is only needed <a href="#game">specific game</a> (option <code>-C</code>) or <a href="#counting">card counting</a> (options <code>-G</code> and <code>-g</code>) analysis tables. By default doubling down after splitting is allowed. Use this <code>-n</code> option to prohibit it. When doubling down after splitting is allowed, it will use the current doubling down rule set with the <code>-l</code> or <code>-r</code> commands.
</dd><dt>-m</dt><dd>Set the resplitting rule. This rule is only needed <a href="#game">specific game</a> (option <code>-C</code>) or <a href="#counting">card counting</a> (options <code>-G</code> and <code>-g</code>) analysis tables. By default resplitting is not allowed. Use this <code>-m</code> option to allow resplitting.</dd><dt>-a</dt><dd>When aces are split, they only get one additional card, but when resplitting is allowed, this options allows another resplit if the additional card is an ace. This rule is only needed <a href="#game">specific game</a> (option <code>-C</code>) or <a href="#counting">card counting</a> (options <code>-G</code> and <code>-g</code>) analysis tables and it only matters when resplitting is allowed (with <code>-m</code> option). By default aces cannot be resplit. Use this <code>-a</code> option to allow resplitting of aces when replitting of other cards is allowed.</dd></dl><p><a name="outoptions"></a>These options set the dealer cache size (import for fastest calculations) and control some features of the output results:</p><dl><dt>-o fname</dt><dd>By default the results are sent to standard output. Use this option to divert the
results to a tab-delimited plain-text file. Give the output filename in <code>fname</code>.</dd><dt>-i4 -f8</dt><dd>The output table will include expected values for dealer up cards from the initial or <code>-i</code> option to the final or <code>-f</code> option. The card number must follow the <code>i</code> or <code>f</code> without a space and be 1 to 9 or <code>T</code> for ten. The sequence can be increasing or decreasing depending on whether the final value is higher or lower than the initial value. The default settings are initial card 1 (or ace) and final card <code>T</code>.</dd><dt>-c num</dt><dd>A dealer cache helps the calculations run much faster. The details are described in a paper by the author [<a href="#nairn">2</a>]. The <code>num</code> is the size of the cache and is limited to 0 through 23. A size of 15 is sufficient for most calculations. Exact splitting calculations can benefit from a larger cache. The maximum size of 23 requires 2.23 G or memory for the cache; if you have less memory an error will result and you will need to reduce the cache size.</dd><dt>-v</dt><dd>When used, the calculations will provide verbose feedback to standard output. This output will only appear with the <code>-o</code> option is used to divert calculations to a file.
</dd>

<dt>-?</dt>
<dd>Print a list of all command options with brief descriptions.</dd></dl><a name="sample"></a><h1>Sample Calculations</h1><p>This section lists some sample calculations.</p><dl><dt>Blackjack -SHDA -d1 -c 18 -o bjtable.txt</dt><dd>This command generates a complete table for a single deck game when the dealer stands on soft 17 and find splitting results using an approximate analysis.</dd><dt>Blackjack -SHDA -i1f6 -h -d1 -c 18 -o bjtable.txt</dt><dd>This command generates a complete table for a single deck game when the dealer hits 17. The results for dealer up card 7 to ten are identical for dealer stands or hits soft 17. Thus if the results when dealer stands on soft 17 are complete, the results for dealer hits soft 17 need only do up cards ace (or 1) through 6).</dd><dt>Blackjack -E2 -d1 -c 23 -o bjtable.txt</dt><dd>This command generates a table of exact expected values for pair splitting when resplitting is not allowed in a single deck game when the dealer stands on soft 17. Warning, this command would take a long time run.</dd><dt>Blackjack -E4 -d1 -c 23 -o bjtable.txt</dt><dd>This command generates a table of exact expected values for pair splitting when resplitting is allowed (to a maximum of four hands) in a single deck game when the dealer stands on soft 17. Warning, this command would take about 45 days to run on a machine with a 3 GHz processor. A better approach is to submit jobs on separate processors and use the <code>-i</code> and <code>-f</code> options to set each job to get results for a single up card.</dd><dt>Blackjack -C -d4 -l -m -c 18 -o bjtable.txt</dt><dd>This command calculates combination tables for all dealer up cards in a four deck game with doubling down on any two cards, doubling down after splitting allowed, and resplitting allowed.</dd><dt>Blackjack -G -d1 -r -n -c 18 -o bjtable.txt</dt><dd>This command calculates Griffin tables [<a href="#griffin">1</a>] for all dealer up cards in a single deck game with doubling down on 10 &amp; 11 only, no doubling down after splitting allowed, and resplitting not allowed.</dd></dl><h1>References</h1><ol><li><a name="griffin"></a>P. A. Griffin, &quot;The Theory of Blackjack,&quot; Sixth Edition. Huntington Press, Las Vegas, NV, 1999.</li><li><a name="nairn"></a>J. A. Nairn, &quot;Exact Calculation of Expected Values for Splitting Pairs in Blackjack,&quot; submitted (2008). (click <a href="../paper/Splitting.pdf">here</a> to see PDF of paper in this project).</li></ol></body></html>
